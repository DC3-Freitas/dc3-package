# DC3Modifier
OVITO package for "Data-centric framework for crystal structure identification in atomistic simulations using machine learning" by Chung et al. (2022)

![image](https://github.com/user-attachments/assets/4a1897de-68cf-48ea-a5e5-7ab12af31e5a)

## Description
OVITO Python modifier that uses a machine learning model trained on synthetic data generated by perturbing perfect lattices to classify the structure of each atom (e.g., `"bcc"`, `"fcc"`, `"hcp"`). The modifier includes an outlier detection system that identifies atoms with amorphous or unknown crystal structures. It also supports training on user-provided perfect lattices and allows saving and loading custom models (note: saving is only supported in Python).

Note that the result is coded by an integer and can be mapped to a string with the attribute `number_to_label` (only supported in Python).

## Parameters
| **Name**      | **Description**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | **Default** |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| `model_input` | Specifies how the DC3 model is created or loaded for classification.<br><br>- **If a `str`**: interpreted as the path to a saved `.pth` full DC3 model (entire model containing neural network weights). The model and its metadata (label map, reference vectors, and cutoff thresholds) are loaded from this file.<br><br>- **If a `dict[str, str \| None]`**: a mapping from structure names (e.g., `"bcc"`, `"fcc"`, `"hcp"`) to OVITO file paths containing perfect lattice structures. If a value is `None`, a default built-in structure is used (supported: `bcc`, `cd`, `fcc`, `hcp`, `hd`, `sc`). A new model is trained using synthetic data generated from these lattices.<br><br>- **If `None`**: loads the default pretrained model which supports classifying `bcc`, `cd`, `fcc`, `hcp`, `hd`, and `sc`. | `None`      |
| `run`         | Boolean flag that determines whether the modifier performs structure classification. If `False`, the modifier does nothing during the pipeline evaluation. Set to `True` to enable classification on each frame.                                                                                                                                                                                                                                                                                                                                                                                               | `False`     |

## Methods and Attributes (Python Only)
| **Attribute**       | **Description**                                                                                                                                                     | **Type**       |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|
| `label_to_number`   | Dictionary mapping structure names (e.g., `"bcc"`, `"fcc"`, `"hcp"`) to integer class labels used internally by the model. Includes `"amorphous"` and `"unknown"` for outlier cases. | `dict[str, int]` |
| `number_to_label`   | Inverse of `label_to_number`: maps integer class labels back to their corresponding structure name. Used to convert model predictions into human-readable labels.   | `dict[int, str]` |

| **Method**            | **Description**                                                                                                                                                                                                                                                                                            | **Arguments**                                                                                                                                                                                                                 | **Returns** |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| `save_full_model()`   | Saves the full DC3 model (entier model including neural network weights) to the specified location. This can only be called from within a Python script and is not available through the OVITO GUI.<br><br>Model is created based on the current value of `model_input`. | - `model_name` (`str`): filename prefix for the saved model (excluding the `.pth` extension).<br><br>- `file_dir` (`str`): path to the directory where the model should be saved.                                        | `None`      |

## Examples

#### Saving
```py
modifier = DC3Modifier()
modifier.model_input = {"fcc": "path to fcc perfect lattice", "bcc": None, "hcp": None, "cd": None}
modifier.save_full_model("name without .pth", "path to save directory")
```
#### Loading
```py
modifier = DC3Modifier()
modifier.model_input = "path to saved model" # To use model from path, set model_input to be the path
```
#### Using
```py
modifier = DC3Modifier()
modifier.run = True          # Must set run to be true if modifier will be used to compute
modifier.model_input = None  # None makes it use the default pretrained model

pipeline = import_file("path to dump")
pipeline.modifiers.append(modifier)

data = pipeline.compute(0)
print([modifier.number_to_label[i] for i in data.particles["structure_type"].array])
```

## Installation
- OVITO Pro [integrated Python interpreter](https://docs.ovito.org/python/introduction/installation.html#ovito-pro-integrated-interpreter):
  ```
  ovitos -m pip install --user https://github.com/DC3-Freitas/dc3-package/archive/refs/heads/main.zip
  ```
  The `--user` option is recommended and [installs the package in the user's site directory](https://pip.pypa.io/en/stable/user_guide/#user-installs).
- Other Python interpreters or Conda environments:
  ```
  pip install https://github.com/DC3-Freitas/dc3-package/archive/refs/heads/main.zip
  ```

## Technical Information
- Tested on OVITO version 3.12.2

## Contact
- Alexander Liang (acliang@mit.edu)
- Jieruei Chang (jieruei@mit.edu)
